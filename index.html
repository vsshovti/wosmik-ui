<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Get Insight</title>
  <style>
    :root {
      --main-color: #9E3CEF;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f7fbfe;
      margin: 0;
      padding: 0;
    }

    .wrapper {
      max-width: 600px;
      margin: 20px auto;
      text-align: center;
    }

    .logo {
      width: 215px;
      height: auto;
      display: block;
      margin: 0 auto 5px auto;
    }

    .container {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid var(--main-color);
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: var(--main-color);
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #7e2fc2;
    }

    .disclaimer {
      font-size: 12px;
      color: #888;
      text-align: center;
      margin-top: 50px;
      padding-bottom: 20px;
    }

    .form-note {
      font-size: 13px;
      color: #aaa;
      margin-top: 12px;
      text-align: center;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      backdrop-filter: blur(6px);
      background: rgba(30, 43, 74, 0.8);
      color: white;
      font-size: 16px;
      padding: 40px;
      box-sizing: border-box;
      overflow-y: auto;
      z-index: 9999;
      text-align: center;
    }

    #progressBar {
      width: 80%;
      background-color: #ccc;
      border-radius: 20px;
      margin: 20px auto;
      height: 16px;
      overflow: hidden;
    }
    #progressBar div {
      height: 100%;
      width: 0;
      background-color: var(--main-color);
      border-radius: 20px;
      transition: width 0.4s ease;
    }

    #overlay-content {
      white-space: pre-wrap;
      text-align: left;
      margin-top: 30px;
    }

    #overlay button {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 16px;
      background: white;
      color: #1e2b4a;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: auto;
    }

    a {
      color: var(--main-color);
      text-decoration: underline;
    }

    .photo-preview {
      max-width: 180px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .social-icon {
      width: 28px;
      height: 28px;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExcWFudXBxeGl0c3NodGxuZ2J4MzFseHU4YjY0Y2dqc29vdnFwbW1ncSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/IsHQp1UjCOJKYtgZO9/giphy.gif" alt="Octopus" class="logo" id="octoLogo">
    <div class="container">
      <input placeholder="First Name" id="firstName">
      <input placeholder="Last Name" id="lastName">
      <input placeholder="Email" id="email">
      <input placeholder="Company" id="company">
      <input placeholder="City" id="city">
      <input placeholder="Country" id="country">
      <input placeholder="Phone" id="phone">
      <input placeholder="Instagram" id="instagram">
      <input placeholder="Facebook" id="facebook">
      <input placeholder="LinkedIn" id="linkedin">
      <input placeholder="Website" id="website">
      <input placeholder="Special Key (e.g. NMLS 123456 or Actor)" id="specialKey">
      <button onclick="analyze()">Get Insight</button>
      <p class="form-note">üßê Fill in as many fields as possible ‚Äî it helps us generate better insights.</p>
    </div>
  </div>

  <p class="disclaimer">
    We do not violate any platform rules. All analysis is based on publicly available data and used responsibly.
  </p>

  <div id="overlay">
    <div id="progressBar"><div></div></div>
    <div id="overlay-content"></div>
    <button onclick="closeOverlay()">Close</button>
  </div>

  <script>
    let progress = 0;
    let interval;

    function startProgressBar() {
      const bar = document.querySelector('#progressBar div');
      progress = 0;
      interval = setInterval(() => {
        progress = Math.min(progress + Math.random() * 10, 95);
        bar.style.width = progress + '%';
      }, 400);
    }

    function completeProgressBar() {
      clearInterval(interval);
      document.querySelector('#progressBar div').style.width = '100%';
    }

    function analyze() {
      const data = {
        firstname: document.getElementById("firstName").value,
        lastname: document.getElementById("lastName").value,
        email: document.getElementById("email").value,
        company: document.getElementById("company").value,
        city: document.getElementById("city").value,
        country: document.getElementById("country").value,
        phone: document.getElementById("phone").value,
        instagram: document.getElementById("instagram").value,
        facebook: document.getElementById("facebook").value,
        linkedin: document.getElementById("linkedin").value,
        website: document.getElementById("website").value,
        special_key: document.getElementById("specialKey").value
      };

      document.getElementById("overlay").style.display = "block";
      document.getElementById("octoLogo").style.display = "none";
      document.getElementById("overlay-content").innerHTML = "";
      startProgressBar();

      fetch("https://wosmik.onrender.com/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
        .then(res => res.json())
        .then(res => {
          completeProgressBar();
          let parsed;
          try {
            parsed = typeof res.result === 'string' ? JSON.parse(res.result) : res.result;
            renderJson(parsed);
          } catch {
            document.getElementById("overlay-content").innerText = res.result || "Invalid result";
          }
        })
        .catch(err => {
          completeProgressBar();
          document.getElementById("overlay-content").innerText = "Error: " + err.message;
        });
    }

    function closeOverlay() {
      document.getElementById("overlay").style.display = "none";
      document.getElementById("octoLogo").style.display = "block";
    }

    function renderJson(json) {
      const container = document.getElementById("overlay-content");
      container.innerHTML = '';
      if (json.photo && json.photo.startsWith("http")) {
        container.innerHTML += `<img src="${json.photo}" class="photo-preview" alt="Profile photo">`;
      }
      for (const key in json) {
        if (key === 'photo') continue;
        const value = json[key];
        container.innerHTML += `<h3 style="color: var(--main-color); margin-top: 18px">${formatKey(key)}</h3>`;
        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
          for (const subKey in value) {
            const subVal = value[subKey];
            container.innerHTML += `<p><strong>${formatKey(subKey)}:</strong> ${formatValue(subVal)}</p>`;
          }
        } else if (Array.isArray(value)) {
          container.innerHTML += '<ul>' + value.map(v => `<li>${formatValue(v)}</li>`).join('') + '</ul>';
        } else {
          container.innerHTML += `<p>${formatValue(value)}</p>`;
        }
        if (key === 'social_profiles') {
          ['linkedin', 'facebook', 'instagram'].forEach(net => {
            if (value[net]) {
              const icon = {
                linkedin: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Linkedin_icon.svg/640px-Linkedin_icon.svg.png',
                facebook: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/Logo_de_Facebook.png/640px-Logo_de_Facebook.png',
                instagram: 'https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png'
              }[net];
              container.innerHTML += `<a href="${value[net]}" target="_blank"><img src="${icon}" class="social-icon" alt="${net}"></a>`;
            }
          });
        }
      }
    }

    function formatKey(key) {
      return key.replace(/[_\-]/g, " ").replace(/([a-z])([A-Z])/g, "$1 $2").replace(/\b\w/g, l => l.toUpperCase());
    }

    function formatValue(value) {
      if (typeof value === "string" && value.startsWith("http")) {
        return `<a href="${value}" target="_blank">${value}</a>`;
      }
      return value ?? "‚Äî";
    }
  </script>
</body>
</html>
